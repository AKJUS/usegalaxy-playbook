---
#
# WARNING: this is shared by both Test and Main
#

_bridges_home_root: "/home/xcgalaxy/{{ galaxy_instance_codename }}"
_bridges_pylon5_root: "/pylon5/mc48nsp/xcgalaxy/{{ galaxy_instance_codename }}"

pulsar_root: "{{ _bridges_home_root }}/pulsar"
galaxy_root: "{{ _bridges_pylon5_root }}/galaxy"

pulsar_server_dir: "{{ pulsar_root }}"
pulsar_dependencies_dir: "{{ _bridges_home_root }}/deps"
pulsar_persistence_dir: "{{ pulsar_root }}/var"
pulsar_staging_dir: "{{ _bridges_pylon5_root }}/staging"

galaxy_user: xcgalaxy
pip_virtualenv_command: "/home/xcgalaxy/virtualenv/bin/virtualenv"
pip_extra_args: "--index-url https://wheels.galaxyproject.org/ --extra-index-url https://pypi.org/simple"

pulsar_drmaa_library_path: "{{ _bridges_home_root }}/slurm-drmaa/lib/libdrmaa.so"

pulsar_dependency_resolvers:
  - name: tool_shed_packages
  - name: galaxy_packages
  - name: conda
    args:
      - name: auto_install
        value: "true"
      - name: auto_init
        value: "true"
  - name: modules
    args:
      - name: modulecmd
        value: /usr/bin/modulecmd

pulsar_job_metrics_plugins:
  - name: core
  - name: cpuinfo
    args:
      - name: verbose
        value: "true"
  - name: meminfo
  - name: uname
  - name: cgroup

pulsar_yaml_config:
  staging_directory: "{{ pulsar_staging_dir }}"
  persistence_directory: "{{ pulsar_persistence_dir }}"
  tool_dependency_dir: "{{ pulsar_dependencies_dir }}"
  conda_prefix: "/pylon5/mc48nsp/xcgalaxy/conda"
  job_metrics_config_file: "{{ pulsar_config_dir }}/job_metrics_conf.xml"
  message_queue_url: "{{ pulsar_message_queue_url }}"
  dependency_resolvers_config_file: "{{ pulsar_config_dir }}/dependency_resolvers_conf.xml"
  maximum_stream_size: 8388608  # 8 MB
  amqp_acknowledge: True
  amqp_ack_republish_time: 180
  amqp_publish_retry: True
  amqp_publish_retry_max_retries: 5
  amqp_publish_retry_interval_start: 10
  amqp_publish_retry_interval_step: 10
  amqp_publish_retry_interval_max: 60
  managers:
    bridges:
      type: queued_drmaa
      preprocess_action_max_retries: 10
      preprocess_action_interval_start: 2
      preprocess_action_interval_step: 2
      preprocess_action_interval_max: 60
      postprocess_action_max_retries: 20
      postprocess_action_interval_start: 2
      postprocess_action_interval_step: 4
      postprocess_action_interval_max: 120
      min_polling_interval: 15
    bridges_nagios:
      type: queued_python
      min_polling_interval: 5

pulsar_install_environments:
  pycurl:
    PYCURL_SSL_LIBRARY: "openssl"
