---

tools:

  # abstract tools for inheritance

  _hpc:
    abstract: true
    #inherits: _default
    scheduling:
      accept:
      - pulsar
      require:
      - hpc

  # real tools

  toolshed.g2.bx.psu.edu/repos/iuc/trinity/trinity/.*:
    cores: 24
    mem: 250
    scheduling:
      require:
      - hpc
      prefer:
      - bridges2
      reject:
      - general
    rules:
      - if: input_size < 0.1
        cores: 1
        mem: 4
        scheduling:
          require:
          - general
          reject:
          - hpc
      - if: 0.1 <= input_size < 1
        cores: 12
        mem: 92
      - if: 1 <= input_size < 4
        cores: 16
        mem: 128
      - if: 4 <= input_size < 8
        cores: 20
        mem: 190
      - if: input_size >= 80
        fail:
          Too much data, we cannot support such large Trinity assemblies with our
          backend. Please use another server for your job.

  toolshed.g2.bx.psu.edu/repos/bgruening/flye/flye/.*:
    cores: 2
    rules:
    - if: 0.15 <= input_size < 0.5
      cores: 4
      mem: 12
      scheduling:
        accept:
        - general
        reject:
        - hpc
    - if: 0.5 <= input_size < 10
      cores: 30
      mem: 80
      scheduling:
        accept:
        - stampede2
        - jetstream2
        prefer:
        - stampede2-knl
        reject:
        - roundup
    - if: input_size >= 10
      # from AU
      #cores: 120
      #mem: 1922
      cores: 56
      mem: 94
      scheduling:
        accept:
        - hpc
        reject:
        - general

  toolshed.g2.bx.psu.edu/repos/iuc/busco/busco/.*:
    # busco crashes with the full thread count because it uses too much memory when forking (even 10-12 was too many)
    cores: 8
    mem: 120
    scheduling:
      accept:
      - hpc
      reject:
      - roundup
      - jetstream2

  toolshed.g2.bx.psu.edu/repos/devteam/bwa/bwa/.*:
    cores: 2
    scheduling:
      accept:
      - pulsar
    rules:
    - if: 0.25 <= input_size < 1
      cores: 4
      mem: cores * 3.6
    - if: input_size >= 1
      cores: 8
      mem: cores * 3.6
  toolshed.g2.bx.psu.edu/repos/bgruening/hifiasm/hifiasm/.*:
    inherits: _hpc
    cores: 64
    mem: 120
    scheduling:
      prefer:
      - stampede2-skx
  verkko:
    cores: 32
    mem: 120
    scheduling:
      accept:
      - pulsar
      reject:
      - hpc
